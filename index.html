<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GPS Tracker</title>
  <style>
    #map {
      height: 600px;
      width: 100%;
    }
  </style>
</head>
<body>

<h2>GPS位置表示（ThingSpeak連携）</h2>
<div id="map"></div>

<script>
  const channelID = "YOUR_CHANNEL_ID";
  const readAPIKey = "YOUR_READ_API_KEY";

  function initMap() {

    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 5,
      center: { lat: 35.0, lng: 135.0 },
    });

    fetch(`https://api.thingspeak.com/channels/${channelID}/feeds.json?api_key=${readAPIKey}&results=50`)
      .then(response => response.json())
      .then(data => {

        const path = [];

        data.feeds.forEach(feed => {
          if (feed.field1 && feed.field2) {
            const lat = parseFloat(feed.field1);
            const lng = parseFloat(feed.field2);

            const position = { lat: lat, lng: lng };

            path.push(position);

            new google.maps.Marker({
              position: position,
              map: map
            });
          }
        });

        if (path.length > 0) {
          map.setCenter(path[path.length - 1]);
          map.setZoom(15);

          new google.maps.Polyline({
            path: path,
            geodesic: true,
            strokeColor: "#FF0000",
            strokeOpacity: 1.0,
            strokeWeight: 2,
            map: map
          });
        }

      });
  }
</script>

<script async
  src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap">
</script>

</body>
</html>
